<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>QBrain</title>
		<link rel="stylesheet" href="css/brain.css">
		<script src="js/utils.js"></script>
		<script src="js/models.js"></script>
	</head>
	<body>
		<div class="home-container" onclick="location.href='https://the-second-brain.github.io/';">
			<div class="home_2">QBrain</div>
		</div>
		<img class="info_button" id="info_button" src="images/info.png" alt="Show info">
		<img class="close_button" id="close_button" src="images/close.png" alt="Close info">
		<div class="color-scale-container" id="color-scale-container">
			<div class="color_scale_header">Samverkan</div>
			<div class="color_scale_high">< Hög</div>
			<div class="color_scale_low">< Låg</div>
			<div class="color_scale"></div>
		</div>
		<h1 id='title'></h1>
		<div class='info-demo'>
			<div id='info-container-demo' class='connection-container-demo'>
				<img class="arrow" id="left_button-demo" src="/images/left.png" alt="Left button">
				<h2 id='section_title_pres-demo'></h2>
				<img class="arrow" id="right_button-demo" src="/images/right.png" alt="Right button">
			</div>
			<h3 id='section_title-demo'></h3>
			<p id='section_intro-demo'></p>
		</div>
		<div class='info'>
			
			<h3 id='section_title'></h3>
			<p id='section_intro'></p>
		</div>
		
		<script type="module">
			
		    import * as THREE from 'https://cdn.skypack.dev/three@0.136.0/build/three.module.js';
		    import { OrbitControls } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js';
		    import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js';
		    import { FontLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FontLoader.js';
		    import { TextGeometry } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/geometries/TextGeometry.js';
		    import { Lensflare, LensflareElement } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/objects/Lensflare.js';
		    
		    const start_color = [255, 5, 5];
		    const end_color = [0, 50, 255];
		    
		    const pres_titles = ["<b style='font-size:24px'>QBrain</b><br><b style='font-size:12px'>Mångdubblar hjärnans kapacitet</b>", "Kubens delar", "Mission", "Aktiviteter", "Förutsättningar", "Fakta", "Historik", "Aktuella planer", "Organisation", "Grupper", "Individer", "AI-stöd", "Sammanfattning"];
		    const pres_texts = ["QBrain är ett AI-baserat stöd för planering, genomförande, utveckling och uppföljning av olika typer av uppdrag. Det kan vara alltifrån ett företags hela verksamhet till olika typer av förändringsarbeten eller mindre projekt inom specifika områden. Systemet utgår ifrån hur vår hjärna fungerar och kompletterar den för att vi skall kunna förverkliga det som är riktigt viktigt.<br><br>QBrain bygger i grunden på de tre stegen som varje uppdrag består av:<br><b style='font-size:20px'>Mission</b> = Hur ser uppdraget ut och vad skall uppnås?<br><b style='font-size:20px'>Aktiviteter</b> = Vad behöver göras för att lyckas med uppdraget?<br><b style='font-size:20px'>Förutsättningar</b> = Vad krävs för att genomföra de aktiviteter som behövs?",
		    
		    					"QBrain består av tre dimensioner varav Planer är den grundläggande som allting utgår ifrån. Varje steg i Planer (Mission – Aktiviteter - Förutsättningar) är kopplade dels till Processer (Fakta - Historik - Aktuella planer) och dels till Personer (Organisation – Grupper - Individer).<br><br>I varje del av kuben finns olika uppgifter som skall genomföras. Det kan vara för en hel organisation, en grupp eller en individ och bestå av att:<ul><li>Ta fram visioner och mål för uppdraget.</li><li>Ta fram strategier och handlingsplaner.</li><li>Analysera förutsättning för att lyckas.</li><li>Utvärdera tidigare uppdrag.</li><li>Använda forskning för att effektivisera uppdraget.</li></ul>Klicka på en del av kuben för mer information om vad som skall göras där.",
		    					
		    					"Här arbetar man med en beskrivning av uppdraget och vad som skall uppnås för en organisation, grupp eller individ. Utifrån fakta och forskning och tidigare genomförda liknande uppdrag tas mission för ett nytt uppdrag fram.<br><br>Det kan exempelvis handla om att definiera:<ul><li>Affärsidé</li><li>Verksamhetsidé</li><li>Projektidé</li><li>Visioner</li><li>Övergripande mål</li></ul>",
		    					
		    					"Här arbetar man med vilka aktiviteter som krävs för att lyckas genomföra ett aktuellt uppdrag för en organisation, grupp eller individ. Utifrån fakta och forskning och tidigare genomförda liknande uppdrag tas nya aktiviteter fram.<br><br>Det kan exempelvis vara:<ul><li>Övergripande strategier för hela organisationen</li><li>Förändringsprocesser som skall implementeras</li><li>Varumärkesstrategier</li><li>Taktiska planer för olika områden</li><li>Handlingsplaner på kortare sikt</li></ul>",
		    					
		    					"Här analyseras vilka förutsättningar som krävs för att genomföra de aktiviteter som tagits fram för att genomföra det aktuella uppdraget. Detta görs utifrån fakta och forskning samt tidigare genomförda liknande uppdrag.<br><br>Det handlar om externa förutsättningar som kan vara:<ul><li>Praktiska (Konjunktur, politik, konkurrens, etc)</li><li>Psykologiska (Kultur, trender, etc)</li></ul>Samt interna förutsättningar som:<ul><li>Praktiska (Ekonomi, lokaler, datakapacitet, etc)</li><li>Psykologiska (Kompetens, motivation, kultur, personligheter, beteendemönster, etc)</li></ul>",
		    					
		    					"Här samlas forskning, fakta och tips kontinuerligt för organisationers, gruppers och individers arbete med planer: Mission, Aktiviteter och Förutsättningar. Allt ifrån konsekvenser på kortare och längre sikt av olika faktorer till konkreta råd för att lyckas framöver.<br><br>Det kan vara:<ul><li>Forskningrapporter</li><li>Expertråd</li><li>Webbutbildningar</li><li>Workshops</li><li>Förslag på planer</li><li>Digital coaching</li></ul>",
		    					
		    					"Här finns tidigare planer lagrade för organisationers, gruppers och individers arbete med Mission, Aktiviteter och Förutsättningar. Allt är utvärderat och omvandlat till konkreta riktlinjer för framtida liknande arbeten med planer.<br><br>Det kan handla om:<ul><li>Vad har fungerat tidigare?</li><li>Hur använda det framöver?</li><li>Vilka problem har uppstått?</li><li>Hur undvika dessa i framtiden?</li></ul>",
		    					
		    					"Här sker arbetet för hela organisationer, grupper och individer med att ta fram och följa upp Aktuella planer med Mission, Aktiviteter och Förutsättningar. Allt arbete här stöds av AI utifrån forskning och fakta samt historik från tidigare liknande arbeten. Beslutade planer lagras sen under historik där resultaten också sparas och slutsatser dras för framtida behov.<br><br>Till exempel:<ul><li>Vilka Aktiviteter är realistiska att genomföra med olika Förutsättningar?</li><li>Vilka Mål är realistiska att nå med olika Aktiviteter?</li><li>Vad leder olika typer av scenarion till för konsekvenser?</li></ul>QBrain väver samman alla dessa avvägningar. Alla perspektiv beaktas och eventuella brister tydliggörs så att beslut kan tas för så stor framgång som möjligt.",
		    					
		    					"Här tas planer fram för organisationer (Mission, Aktiviteter och Förutsättningar). Arbetet görs med hjälp av AI utifrån forskning och fakta samt historik från organisationens tidigare liknande arbeten.<br><br>Till exempel:<ul><li>Vilka Aktiviteter är realistiska för organisationen att genomföra med olika Förutsättningar?</li><li>Vilka Mål är realistiska för organisationen att nå med olika Aktiviteter?</li><li>Vilka Konsekvenser leder olika typer av scenarion till för organisationen?</li></ul>",
		    					
		    					"Här arbetar man med planer för grupper (Mission, Aktiviteter och Förutsättningar). Arbetet görs med hjälp av AI utifrån forskning och fakta samt historik från gruppens liknande arbeten.<br><br>Till exempel:<ul><li>Vilka Aktiviteter är realistiska för gruppen att genomföra med olika Förutsättningar?</li><li>Vilka Mål är realistiska för gruppen att nå med olika Aktiviteter?</li><li>Vilka Konsekvenser leder olika typer av scenarion till för gruppen?</li></ul>",
		    					
		    					"Här tas planer fram för individer (Mission, Aktiviteter och Förutsättningar). Arbetet görs med hjälp av AI utifrån forskning och fakta samt historik från individens liknande arbeten.<br><br>Till exempel:<ul><li>Vilka Aktiviteter är realistiska för individen att genomföra med olika Förutsättningar?</li><li>Vilka Mål är realistiska för individen att nå med olika Aktiviteter?</li><li>Vilka Konsekvenser leder olika typer av scenarion till för individen?</li></ul>",
		    					
		    					"Samtliga delar i systemet, <b>Planer</b>, <b>Processer</b> och <b>Personer</b> samverkar med varandra med stöd av AI. Utifrån forskning, fakta och tidigare erfarenheter av liknande uppdrag stöder AI formuleringen av Mission med uppdrag, visioner och mål.<br><br>På samma sätt hjälper AI till att formulera de <i>Aktiviteter</i> som krävs för att genomföra uppdraget och uppnå satta visioner och mål samt säkerställer att rätt <i>Förutsättningar</i> finns för att genomföra aktiviteterna på rätt sätt. Dessutom möjliggör systemet att koppla samman och hantera sambanden mellan organisationers, gruppers och individers arbeten.<br><br>Genom AI-stödd samverkan mellan Planer, Processer och Personer kan organisationen skapa en arbetsmiljö där alla delar fungerar tillsammans med effektiv kommunikation och samarbete och därmed uppnå större framgång.<br><br>Områden som samverkar väl markeras med blått och områden som inte fungerar tillsammans med andra och kräver mer arbete markeras med rött.",
		    					
		    					'QBrain är ett AI-baserat stöd för planering, genomförande och uppföljning av alla typer av uppdrag, stora som små för hela organisationer, grupper och individer. Man utgår ifrån uppdragets Mission (Idé. Syfte, Mål och Visioner), tar fram Aktiviteter (Strategier, Taktiska planer, Handlingsplaner) samt Förutsättningar (Externa o Interna – Praktiska o Psykologiska). Allt stäms av mot forskning och fakta samt tidigare erfarenheter av liknande uppdrag.'];
		    
		    const scene = new THREE.Scene();
		    const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
		    const renderer = new THREE.WebGLRenderer( { antialias: true } );
		    const geometry = new THREE.BoxGeometry();
		    const textureLoader = new THREE.TextureLoader();
			const textureFlare0 = textureLoader.load( 'images/lensflare0.png' );
			const textureFlare3 = textureLoader.load( 'images/lensflare3.png' );
			const pres_index = parseInt(localStorage.getItem("pres_idx"));
			
			
			localStorage.setItem("time", JSON.stringify(Date.now() * 0.0001));
		    
		    let cubes = JSON.parse(localStorage.getItem("cubes"));
		    let current_cube;
		    for (let i = 0; i < cubes.length; i++) {
				if(cubes[i].id == localStorage.getItem("current_cube")) {
					current_cube = cubes[i];
				}
			}
			document.getElementById("title").innerHTML = current_cube.title;
			if (pres_index >= 0) {
				current_cube = JSON.parse(localStorage.getItem("pres_cube"));
				showPresentation(pres_index, current_cube);
				document.getElementById("close_button").style.display = "block";
				document.getElementById("info_button").style.display = "none";
			} else {
				document.getElementById("info_button").style.display = "block";
			}
			
		    const controls = new OrbitControls( camera, renderer.domElement );
		    const gltfLoader = new GLTFLoader();
		    
		    const color = 0xFFFFFF;
		    const intensity = 1;
		    const light = new THREE.DirectionalLight(color, intensity);
		    light.position.set(-1, 2, 4);
		    scene.add(light);	
		    scene.add( new THREE.AmbientLight( 0xffffff, 0.4 ) );
			
		    let objects = [];
		    let secs = current_cube.sections;
		    for (let pos = 0; pos < secs.length; pos++) {
		    	const cube_color = getColor(current_cube, secs[pos]);
		    	const material = new THREE.MeshPhongMaterial( cube_color );
		    	const cube = new THREE.Mesh( geometry, material );
		    	let x = 1;
		    	let y = 1;
		    	let z = 1;
		    	if (pos % 3 == 0) {
					x = -1;
				} else if (pos % 3 == 1) {
					x = 0;
				}
				if (Math.floor(pos / 3) % 3 == 0) {
					y = -1;
				} else if (Math.floor(pos / 3) % 3 == 1) {
					y = 0;
				}
				if (Math.floor(pos / 9) == 0) {
					z = -1;
				} else if (Math.floor(pos / 9) == 1) {
					z = 0;
				}
				const gap = 1.25;
				cube.position.set( x * gap, y * gap, z * gap );
				cube.material.transparent = true;
		    	cube.material.opacity = 0.85; 
		    	if(!secs[pos].active) {
		    		cube.material.opacity = 0.4; 
		    	}
		    	cube.userData = {
                	id: secs[pos].id,
                	title: secs[pos].title,
                	intro: secs[pos].intro,
                	active: secs[pos].active,
                	strength: getStrength(current_cube, secs[pos], pres_index)
            	};
            	scene.add( cube );
            	objects.push(cube);
		    }
		    
		    if(camera.position.x == 0) {
		    	camera.position.set(4.2,3.2,4.2);
		    }
		    camera.lookAt(new THREE.Vector3(0,0,0)); 
		    let raycaster = new THREE.Raycaster();
		    let mouse = new THREE.Vector2();
		    renderer.setPixelRatio(window.devicePixelRatio);
		    
		    renderer.setSize( window.innerWidth, window.innerHeight );
		    document.body.appendChild( renderer.domElement );

			window.addEventListener( 'resize', onWindowResize );
		    
		    document.addEventListener( 'dblclick', onDocumentDoubleClicked, false );
		    document.addEventListener("mousedown", onMouseDown);
		    document.getElementById("info_button").addEventListener("click", openInfo);
		    document.getElementById("close_button").addEventListener("click", closeInfo);
		    
		    document.getElementById("left_button-demo").addEventListener('click', (() => {
		    	let idx = pres_index;
				if(idx == 0) {
					idx = pres_texts.length - 1;
				} else {
					idx -= 1;
				}
				localStorage.setItem("pres_idx", idx + "");
				location.reload();
			}));
			
			document.getElementById("right_button-demo").addEventListener('click', (() => {
				let idx = pres_index;
				idx = (idx + 1) % pres_texts.length;
				localStorage.setItem("pres_idx", idx + "");
				location.reload();
			}));
		    
		    function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			function addLight( h, s, l, x, y, z ) {

				const light = new THREE.PointLight( 0xffffff, 1.5, 2000 );
				light.color.setHSL( h, s, l );
				light.position.set( x, y, z );
				scene.add( light );

				const lensflare = new Lensflare();
				lensflare.addElement( new LensflareElement( textureFlare0, 700, 0, light.color ) );
				lensflare.addElement( new LensflareElement( textureFlare3, 60, 0.6 ) );
				lensflare.addElement( new LensflareElement( textureFlare3, 70, 0.7 ) );
				lensflare.addElement( new LensflareElement( textureFlare3, 120, 0.9 ) );
				lensflare.addElement( new LensflareElement( textureFlare3, 70, 1 ) );
				light.add( lensflare );

			}
			
			function onDocumentDoubleClicked(event) {
				if (pres_index < 0) {
					event.preventDefault();
					mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
					mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
					raycaster.setFromCamera( mouse, camera );
					var intersects = raycaster.intersectObjects( objects );
					if (intersects.length > 0) {
		    			localStorage.setItem('current_section', intersects[0].object.userData.id);
		    			window.location.href = "section";
					}
    			}
			}
			
			function onMouseDown(event) {
    			event.preventDefault();
    			mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
    			raycaster.setFromCamera( mouse, camera );
				var intersects = raycaster.intersectObjects( objects );
				for (let i = 0; i < objects.length; i++) {
					let opacity;
					if(objects[i].userData.active) {
						opacity = 0.85;
					} else {
						opacity = 0.4;
					}
    				const material = new THREE.MeshPhongMaterial( { color: "#ff0000" } );
    				material.color = objects[i].material.color;
    				material.transparent = true;
    				material.opacity = opacity; 
    				objects[i].material = material;
    			}
    			if (intersects.length > 0) {
        			document.getElementById("section_title").innerHTML = intersects[0].object.userData.title;
        			document.getElementById("section_intro").innerHTML = intersects[0].object.userData.intro;
        			intersects[0].object.material.opacity = 1; 
        			if (pres_index < 0) {
		    			if(intersects[0].object.userData.active) {
		    				intersects[0].object.material.emissive = intersects[0].object.material.color; 
		    				document.getElementById("section_title").innerHTML += " (" + intersects[0].object.userData.strength + "&nbsp%)";
		    			} else {
		    				document.getElementById("section_title").innerHTML += " (Inaktiv)";
		    				intersects[0].object.material.opacity = 0.7; 
		    			};
        			}
    			}
			}

			function openInfo(event) {
    			event.preventDefault();
				if (pres_index < 0) {
					localStorage.setItem("pres_idx", "0");
					let pres_cube = new_std_cube("");
					for (let i = 0; i < pres_cube.sections.length; i++) {
						let connections = getSectionConnections(pres_cube, pres_cube.sections[i].id);
						for (let j = 0; j < connections.length; j++) {
							connections[j].strength = 100;
						}
					}
					localStorage.setItem("pres_cube", JSON.stringify(pres_cube));
					location.reload();
				}
			}
			
			function closeInfo(event) {
    			event.preventDefault();
				localStorage.setItem("pres_idx", "-1");
				location.reload();
			}
			
			function getBigText(text, x, y, z, txt_mat, font) {
				let big_text_settings = {
					font: font,
					size: 0.28,
					height: 0.03,
					curveSegments: 12,
					bevelEnabled: false,
					bevelThickness: 0.1,
					bevelSize: 0.1,
					bevelSegments: 0.1
				};
				var ret = new THREE.Mesh(new TextGeometry( text, big_text_settings ), txt_mat);
				ret.position.z = z;
				ret.position.y = y;
				ret.position.x = x;
				ret.rotation.set(0, Math.PI/4, 0);
				return ret;
			}
			
			function getSmallText(text, x, y, z, txt_mat, font) {
				let small_text_settings = {
					font: font,
					size: 0.2,
					height: 0.03,
					curveSegments: 12,
					bevelEnabled: false,
					bevelThickness: 0.1,
					bevelSize: 0.1,
					bevelSegments: 0.1
				};
				var ret = new THREE.Mesh(new TextGeometry( text, small_text_settings ), txt_mat);
				ret.position.z = z;
				ret.position.y = y;
				ret.position.x = x;
				ret.rotation.set(0, Math.PI/4, 0);
				return ret;
			}
			
			function showPresentation(idx, cube) {
				let title = "Guide (";
				document.getElementById("left_button-demo").style.display = "block";
				document.getElementById("right_button-demo").style.display = "block";
				document.getElementById("info-container-demo").style.alignItems = "center";
				document.getElementById("info-container-demo").style.justifyContent = "center";
				document.getElementById("section_title_pres-demo").style.textAlign = "center";
				document.getElementById("section_title_pres-demo").style.textAlign = "center";
				document.getElementById("section_title_pres-demo").style.width = "200px";
				document.getElementById("section_title_pres-demo").innerHTML = pres_titles[idx];
				document.getElementById("section_intro-demo").innerHTML = pres_texts[idx];
				
				var loader = new FontLoader();
				var txt_mat = new THREE.MeshPhongMaterial({color:0xffffff});
				addLight( 0.59, 0.8, 0.5,-5, 7, -20 );
				camera.position.set(6.5,2.5,6.5);
				
				title += (idx + 1) + "";
				switch (idx) {
					case 0:
						camera.position.set(5.5,2.5,5.5);
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
						} );
					break;
					case 1:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
					break;
					case 2:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(Math.floor(i / 3) % 3 == 2) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 3:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(Math.floor(i / 3) % 3 == 1) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 4:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(Math.floor(i / 3) % 3 == 0) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 5:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(i % 3 == 0) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 6:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(i % 3 == 1) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 7:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(i % 3 == 2) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 8:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(Math.floor(i / 9) == 2) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 9:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(Math.floor(i / 9) == 1) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 10:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
							if(Math.floor(i / 9) == 0) {
								cube.sections[i].active = 1;
							} else {
								cube.sections[i].active = 0;
							}
						}
					break;
					case 11:
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
							
							var processes = getBigText('Processer', -2.26, -1.6, 3.23, txt_mat, font);
							objects[26].add(processes);
							
							var facts = getSmallText('Fakta', -1.66, -2.13, 2.63, txt_mat, font);
							objects[26].add(facts);
							
							var history = getSmallText('Historik', -1.46, -2.55, 2.43, txt_mat, font);
							objects[26].add(history);
							
							var current_plans = getSmallText('Aktuella planer', -1.35, -3, 2.32, txt_mat, font);
							objects[26].add(current_plans);
							
							var people = getBigText('Personer', 2.03, -1.6, -1.06, txt_mat, font);
							objects[26].add(people);
							
							var individuals = getSmallText('Individer', 1.93, -2.13, -0.96, txt_mat, font);
							objects[26].add(individuals);
							
							var groups = getSmallText('Grupper', 1.63, -2.55, -0.66, txt_mat, font);
							objects[26].add(groups);
							
							var organisation = getSmallText('Organisation', 1.09, -3, -0.12, txt_mat, font);
							objects[26].add(organisation);
						
						});
						for (let i = 0; i < cube.sections.length; i++) {
						let connections = getSectionConnections(cube, cube.sections[i].id)
							for (let j = 0; j < connections.length; j++) {
								if(Math.random() < 0.5) {
									connections[j].strength = 0;
								} else {
									connections[j].strength = 100;
								}
							}
						}
					break;
					case 12:
						camera.position.set(5.5,2.5,5.5);
						loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/droid/droid_sans_bold.typeface.json',function(font) {
							var plans = getBigText('Planer', 0.06, 1, 0.93, txt_mat, font);
							objects[26].add(plans);
							
							var mission = getSmallText('Mission', 0.14, -0.05, 0.85, txt_mat, font);
							objects[26].add(mission);
							
							var activities = getSmallText('Aktiviteter', 0, -1.25, 1, txt_mat, font);
							objects[26].add(activities);
							
							var conditions = getSmallText('Förutsättningar', -0.25, -2.45, 1.25, txt_mat, font);
							objects[26].add(conditions);
						} );
					break;
				}
				title += "/" + pres_texts.length + ")";
				document.getElementById("title").innerHTML = title;
			}
			
			function restore_active() {
				let active_list = JSON.parse(localStorage.getItem("active_list"));
				let cube;
				let cubes = JSON.parse(localStorage.getItem("cubes"));
				for (let i = 0; i < cubes.length; i++) {
					if(cubes[i].id == localStorage.getItem("current_cube")) {
						cube = cubes[i];
					}
				}
				for (let i = 0; i < cube.sections.length; i++) {
					cube.sections[i].active = active_list[i];
				}
				localStorage.setItem("cubes", JSON.stringify(cubes));
				localStorage.setItem("pres_idx", "-1");
				location.reload();
			}
			
			function getColor(cube, section) {
				if(!section.active) {
					return {color: "#333"}
				}
				let strength = getStrength(cube, section, pres_index);
				let r, g;
				let b = "00";
				if(strength <= 50) {
					r = "ff";
					g = (255 * strength) / 50;
					g = Math.round(g).toString(16);
					if(g.length == 1) {
						g = "0" + g;
					}
				} else {
					g = "ff";
					r = (255 * (100 - strength)) / 50;
					r = Math.round(r).toString(16);
					b = (50 * (strength - 50)) / 50;
					b = Math.round(b).toString(16);
					if(r.length == 1) {
						r = "0" + r;
					}
					if(b.length == 1) {
						b = "0" + b;
					}
				}
				
				let rr = Math.round(start_color[0] + ((end_color[0] - start_color[0]) / 100) * strength).toString(16);
				if(rr.length == 1) {
					rr = "0" + rr;
				}
				let gg = Math.round(start_color[1] + ((end_color[1] - start_color[1]) / 100) * strength).toString(16);
				if(gg.length == 1) {
					gg = "0" + gg;
				}
				let bb = Math.round(start_color[2] + ((end_color[2] - start_color[2]) / 100) * strength).toString(16);
				if(bb.length == 1) {
					bb = "0" + bb;
				}
				
				let colorString = "#" + r + g + b;
				colorString = "#" + rr + gg + bb;
				return {color: colorString};
			}
			
			function render() {
				const time = parseInt(localStorage.getItem("time"));
				const timer = Date.now() * 0.0001;
				scene.traverse( function ( object ) {
					if ( object.isMesh === true ) {
						object.rotation.x = timer * 5;
						object.rotation.y = timer * 2.5;
						object.position.x = object.position.x + (timer - time)*0.01;
					}
				} );

				renderer.render( scene, camera );

			}


		    function animate() {
		        requestAnimationFrame( animate );
		        renderer.render( scene, camera );
		    }
		    animate();

		</script>
	</body>
</html>
